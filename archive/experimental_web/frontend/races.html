<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Race Events - Uma Racing Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .navbar {
            padding: 15px 30px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 50;
        }

        .navbar-brand {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .navbar-buttons {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 32px;
            font-weight: 700;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-group label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .filter-group select {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
        }

        .race-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .race-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .race-card:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.4);
            transform: translateX(5px);
        }

        .race-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .race-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .race-badge {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .race-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .race-status.upcoming {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .race-status.ongoing {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .race-status.finished {
            background: rgba(107, 114, 128, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .race-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meta-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meta-value {
            font-size: 14px;
            font-weight: 600;
            color: #e0e0e0;
        }

        .meta-value.primary {
            color: #667eea;
        }

        .race-description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.5;
        }

        .race-requirements {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .req-tag {
            padding: 4px 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 4px;
            font-size: 12px;
        }

        .race-participants {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .participant-avatars {
            display: flex;
            margin-left: 10px;
        }

        .participant-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: -8px;
            border: 2px solid rgba(26, 26, 46, 1);
        }

        .race-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            padding-top: 15px;
            border-top: 1px solid rgba(102, 126, 234, 0.1);
        }

        .action-btn {
            flex: 1;
            padding: 10px 20px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.7);
        }
    </style>
    <link rel="stylesheet" href="assets/page-transitions.css">
    <link rel="stylesheet" href="assets/loading-overlay.css">
</head>
<body>
    <div class="navbar">
        <div class="navbar-brand">üèÅ Race Events</div>
        <div class="navbar-buttons">
            <button class="nav-btn" onclick="navigateTo('/main-menu.html')">Main Menu</button>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <h1>Race Events</h1>
        </div>

        <div class="filter-section">
            <div class="filter-group">
                <label>Status:</label>
                <select id="statusFilter" onchange="filterRaces()">
                    <option value="all">All Races</option>
                    <option value="upcoming">Upcoming</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="finished">Finished</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Difficulty:</label>
                <select id="difficultyFilter" onchange="filterRaces()">
                    <option value="all">All Levels</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Distance:</label>
                <select id="distanceFilter" onchange="filterRaces()">
                    <option value="all">Any Distance</option>
                    <option value="short">Short (1-2 miles)</option>
                    <option value="medium">Medium (2-5 miles)</option>
                    <option value="long">Long (5+ miles)</option>
                </select>
            </div>
        </div>

        <div id="racesList" class="race-list">
            <!-- Races will be loaded here -->
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üèÅ</div>
            <h2>No races found</h2>
            <p>Try adjusting your filters or check back later for new events!</p>
        </div>
    </div>

    <script src="assets/api-config.js"></script>
    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentUser = null;
        let allRaces = [];

        async function init() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Not authenticated');
                currentUser = await response.json();
                await loadRaces();
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = '/login.html';
            }
        }

        async function loadRaces() {
            try {
                // Mock data - replace with actual API call
                allRaces = [
                    {
                        id: 1,
                        name: "Arima Kinen Championship",
                        icon: "üèÜ",
                        type: "G1 Race",
                        course: "Nakayama Racecourse",
                        distance: 2000,
                        surface: "Turf",
                        status: "upcoming",
                        difficulty: "advanced",
                        startTime: "2025-01-15 14:00",
                        participants: 8,
                        maxParticipants: 12,
                        description: "The prestigious Arima Kinen, one of the most important races of the year.",
                        requirements: ["Level 20+", "Win Rate 50%+"],
                        entrants: ['trainer_demo', 'admin', 'racer_user']
                    },
                    {
                        id: 2,
                        name: "Tenno Sho Autumn",
                        icon: "üëë",
                        type: "G1 Race",
                        course: "Kyoto Racecourse",
                        distance: 2000,
                        surface: "Turf",
                        status: "ongoing",
                        difficulty: "advanced",
                        startTime: "2025-01-12 13:30",
                        participants: 10,
                        maxParticipants: 12,
                        description: "One of the most prestigious races with elite participants.",
                        requirements: ["Level 18+", "Experience required"],
                        entrants: ['trainer_demo', 'admin']
                    },
                    {
                        id: 3,
                        name: "Champions Cup G1",
                        icon: "ü•á",
                        type: "G1 Race",
                        course: "Tokyo Racecourse",
                        distance: 1600,
                        surface: "Dirt",
                        status: "upcoming",
                        difficulty: "intermediate",
                        startTime: "2025-01-20 15:00",
                        participants: 5,
                        maxParticipants: 10,
                        description: "A challenging dirt track race for intermediate to advanced trainers.",
                        requirements: ["Level 10+"],
                        entrants: ['trainee_demo']
                    },
                    {
                        id: 4,
                        name: "QEII Cup",
                        icon: "üéñÔ∏è",
                        type: "G2 Race",
                        course: "Kyoto Racecourse",
                        distance: 2400,
                        surface: "Turf",
                        status: "finished",
                        difficulty: "intermediate",
                        startTime: "2025-01-08 14:00",
                        participants: 9,
                        maxParticipants: 12,
                        description: "A completed race showcasing competitive spirit.",
                        requirements: ["Level 5+"],
                        entrants: ['trainer_demo', 'admin', 'trainee_demo']
                    },
                    {
                        id: 5,
                        name: "Beginner's Classic",
                        icon: "üåü",
                        type: "G3 Race",
                        course: "Fukushima Racecourse",
                        distance: 1200,
                        surface: "Dirt",
                        status: "upcoming",
                        difficulty: "beginner",
                        startTime: "2025-01-18 12:00",
                        participants: 3,
                        maxParticipants: 8,
                        description: "Perfect for new trainers to learn the basics.",
                        requirements: ["Any level"],
                        entrants: ['trainee_demo']
                    }
                ];

                filterRaces();
            } catch (error) {
                console.error('Failed to load races:', error);
            }
        }

        function filterRaces() {
            const statusFilter = document.getElementById('statusFilter').value;
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            const distanceFilter = document.getElementById('distanceFilter').value;

            let filtered = allRaces.filter(race => {
                if (statusFilter !== 'all' && race.status !== statusFilter) return false;
                if (difficultyFilter !== 'all' && race.difficulty !== difficultyFilter) return false;
                
                if (distanceFilter !== 'all') {
                    const dist = race.distance;
                    if (distanceFilter === 'short' && dist > 2000) return false;
                    if (distanceFilter === 'medium' && (dist < 2000 || dist > 5000)) return false;
                    if (distanceFilter === 'long' && dist < 5000) return false;
                }
                
                return true;
            });

            renderRaces(filtered);
        }

        function renderRaces(races) {
            const container = document.getElementById('racesList');
            const emptyState = document.getElementById('emptyState');

            if (races.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'flex';
            emptyState.style.display = 'none';

            container.innerHTML = races.map(race => `
                <div class="race-card">
                    <div class="race-header">
                        <div class="race-title">
                            ${race.icon} ${race.name}
                            <span class="race-badge">${race.type}</span>
                        </div>
                        <div class="race-status ${race.status}">${race.status.toUpperCase()}</div>
                    </div>

                    <div class="race-meta">
                        <div class="meta-item">
                            <div class="meta-label">Course</div>
                            <div class="meta-value">${race.course}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Distance</div>
                            <div class="meta-value primary">${race.distance}m</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Surface</div>
                            <div class="meta-value">${race.surface}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Start Time</div>
                            <div class="meta-value primary">${race.startTime}</div>
                        </div>
                    </div>

                    <div class="race-description">${race.description}</div>

                    <div class="race-requirements">
                        ${race.requirements.map(req => `<span class="req-tag">üìã ${req}</span>`).join('')}
                    </div>

                    <div class="race-participants">
                        <span>${race.participants}/${race.maxParticipants} Participants</span>
                        <div class="participant-avatars">
                            ${race.entrants.slice(0, 3).map(name => `
                                <div class="participant-avatar" title="${name}">${name.charAt(0).toUpperCase()}</div>
                            `).join('')}
                            ${race.entrants.length > 3 ? `
                                <div class="participant-avatar" title="+${race.entrants.length - 3} more">+${race.entrants.length - 3}</div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="race-actions">
                        <button class="action-btn" onclick="viewDetails(${race.id})">View Details</button>
                        ${race.status === 'upcoming' ? `
                            <button class="action-btn primary" onclick="enterRace(${race.id})">Enter Race</button>
                        ` : ''}
                        ${race.status === 'finished' ? `
                            <button class="action-btn" onclick="viewResults(${race.id})">View Results</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function viewDetails(raceId) {
            const race = allRaces.find(r => r.id === raceId);
            alert(`Race: ${race.name}\n\nDetails coming soon!`);
        }

        function enterRace(raceId) {
            const race = allRaces.find(r => r.id === raceId);
            if (race.participants < race.maxParticipants) {
                race.participants++;
                race.entrants.push(currentUser.username);
                filterRaces();
                alert(`Successfully entered ${race.name}!`);
            } else {
                alert('This race is full!');
            }
        }

        function viewResults(raceId) {
            alert('Race results coming soon!');
        }

        // Initialize on page load
        init();
    </script>
    <script src="assets/loading-overlay.js"></script>
    <script src="assets/page-transitions.js"></script>
</body>
</html>
